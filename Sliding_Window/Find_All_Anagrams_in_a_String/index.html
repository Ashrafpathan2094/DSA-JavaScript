<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Find Anagrams â€” DSA Notes</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Syne:wght@400;600;800&display=swap");

      :root {
        --bg: #0d0f14;
        --surface: #161a23;
        --border: #252b38;
        --accent: #f0c040;
        --accent2: #5bf5b0;
        --accent3: #ff6b6b;
        --text: #c8d0e0;
        --muted: #6b7a96;
        --code-bg: #1a1f2e;
        --match: #5bf5b080;
        --slide-out: #ff6b6b40;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        background: var(--bg);
        color: var(--text);
        font-family: "Syne", sans-serif;
        min-height: 100vh;
        padding: 40px 20px;
      }

      .page {
        max-width: 900px;
        margin: 0 auto;
      }

      /* â”€â”€ HEADER â”€â”€ */
      .header {
        border-left: 4px solid var(--accent);
        padding-left: 20px;
        margin-bottom: 48px;
      }
      .header .tag {
        font-family: "JetBrains Mono", monospace;
        font-size: 11px;
        color: var(--accent);
        letter-spacing: 3px;
        text-transform: uppercase;
        margin-bottom: 8px;
      }
      .header h1 {
        font-size: clamp(28px, 5vw, 48px);
        font-weight: 800;
        color: #fff;
        line-height: 1;
      }
      .header .meta {
        margin-top: 12px;
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }
      .badge {
        font-family: "JetBrains Mono", monospace;
        font-size: 11px;
        padding: 4px 10px;
        border-radius: 4px;
        border: 1px solid var(--border);
        color: var(--muted);
      }
      .badge.green {
        border-color: var(--accent2);
        color: var(--accent2);
      }
      .badge.yellow {
        border-color: var(--accent);
        color: var(--accent);
      }

      /* â”€â”€ SECTION â”€â”€ */
      section {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 28px 32px;
        margin-bottom: 24px;
        animation: fadeUp 0.4s ease both;
      }
      section:nth-child(2) {
        animation-delay: 0.05s;
      }
      section:nth-child(3) {
        animation-delay: 0.1s;
      }
      section:nth-child(4) {
        animation-delay: 0.15s;
      }
      section:nth-child(5) {
        animation-delay: 0.2s;
      }
      section:nth-child(6) {
        animation-delay: 0.25s;
      }

      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(16px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .sec-label {
        font-family: "JetBrains Mono", monospace;
        font-size: 10px;
        color: var(--muted);
        letter-spacing: 2px;
        text-transform: uppercase;
        margin-bottom: 14px;
      }
      h2 {
        font-size: 20px;
        font-weight: 800;
        color: #fff;
        margin-bottom: 16px;
      }
      p {
        line-height: 1.7;
        color: var(--text);
        font-size: 15px;
        margin-bottom: 10px;
      }
      p:last-child {
        margin-bottom: 0;
      }

      /* â”€â”€ CODE â”€â”€ */
      .code-block {
        background: var(--code-bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 20px 22px;
        font-family: "JetBrains Mono", monospace;
        font-size: 13px;
        line-height: 1.8;
        overflow-x: auto;
        counter-reset: line;
      }
      .code-block .line {
        display: block;
        position: relative;
        padding-left: 36px;
        white-space: pre;
      }
      .code-block .line::before {
        counter-increment: line;
        content: counter(line);
        position: absolute;
        left: 0;
        color: var(--muted);
        width: 24px;
        text-align: right;
        font-size: 11px;
      }
      .kw {
        color: #c792ea;
      }
      .fn {
        color: #82aaff;
      }
      .str {
        color: var(--accent2);
      }
      .num {
        color: var(--accent);
      }
      .cmt {
        color: var(--muted);
        font-style: italic;
      }
      .hi {
        background: #f0c04018;
        border-radius: 3px;
      }

      /* â”€â”€ INSIGHT CARDS â”€â”€ */
      .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 14px;
        margin-top: 4px;
      }
      .card {
        background: var(--code-bg);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 16px 18px;
      }
      .card .icon {
        font-size: 22px;
        margin-bottom: 8px;
      }
      .card h3 {
        font-size: 13px;
        font-weight: 600;
        color: #fff;
        margin-bottom: 6px;
      }
      .card p {
        font-size: 13px;
        margin: 0;
        color: var(--muted);
      }

      /* â”€â”€ VISUALIZATION â”€â”€ */
      .viz-container {
        background: var(--code-bg);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 24px;
        margin-top: 8px;
      }
      .viz-controls {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 24px;
        flex-wrap: wrap;
      }
      .viz-input {
        font-family: "JetBrains Mono", monospace;
        background: var(--border);
        border: 1px solid var(--muted);
        border-radius: 6px;
        color: #fff;
        padding: 7px 12px;
        font-size: 13px;
        width: 160px;
        outline: none;
        transition: border-color 0.2s;
      }
      .viz-input:focus {
        border-color: var(--accent);
      }
      .viz-label {
        font-size: 13px;
        color: var(--muted);
        font-family: "JetBrains Mono", monospace;
      }
      .btn {
        font-family: "Syne", sans-serif;
        font-weight: 700;
        font-size: 13px;
        padding: 8px 18px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        transition: all 0.15s;
      }
      .btn-primary {
        background: var(--accent);
        color: #0d0f14;
      }
      .btn-primary:hover {
        background: #ffd060;
      }
      .btn-secondary {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--muted);
      }
      .btn-secondary:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      /* String display */
      .str-display {
        display: flex;
        gap: 4px;
        flex-wrap: wrap;
        margin-bottom: 20px;
        align-items: center;
      }
      .char-box {
        width: 40px;
        height: 40px;
        border-radius: 6px;
        border: 2px solid var(--border);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-family: "JetBrains Mono", monospace;
        font-size: 16px;
        font-weight: 700;
        color: #fff;
        position: relative;
        transition: all 0.3s;
      }
      .char-box .idx {
        font-size: 9px;
        color: var(--muted);
        position: absolute;
        bottom: -18px;
        font-weight: 400;
      }
      .char-box.in-window {
        border-color: var(--accent);
        background: #f0c04015;
      }
      .char-box.match {
        border-color: var(--accent2);
        background: #5bf5b018;
      }
      .char-box.entering {
        border-color: var(--accent);
        background: #f0c04030;
        transform: scale(1.1);
      }
      .char-box.leaving {
        border-color: var(--accent3);
        background: #ff6b6b20;
        opacity: 0.5;
      }

      /* Freq bars */
      .freq-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }
      .freq-title {
        font-size: 12px;
        color: var(--muted);
        font-family: "JetBrains Mono", monospace;
        margin-bottom: 10px;
      }
      .freq-bars {
        display: flex;
        gap: 2px;
        align-items: flex-end;
        height: 60px;
      }
      .freq-bar-wrap {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2px;
        flex: 1;
      }
      .freq-bar {
        width: 100%;
        background: var(--border);
        border-radius: 3px 3px 0 0;
        transition:
          height 0.3s ease,
          background 0.3s;
        min-height: 2px;
      }
      .freq-bar.active {
        background: var(--accent);
      }
      .freq-bar-label {
        font-size: 8px;
        color: var(--muted);
        font-family: "JetBrains Mono", monospace;
      }

      /* Step info */
      .step-info {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 14px 18px;
        font-family: "JetBrains Mono", monospace;
        font-size: 13px;
        line-height: 1.9;
        min-height: 80px;
      }
      .step-info .match-found {
        color: var(--accent2);
        font-weight: 700;
      }
      .step-info .no-match {
        color: var(--muted);
      }
      .step-info .step-num {
        color: var(--accent);
      }

      /* Results */
      .results-row {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-top: 14px;
        align-items: center;
        min-height: 32px;
      }
      .result-badge {
        background: #5bf5b020;
        border: 1px solid var(--accent2);
        color: var(--accent2);
        padding: 4px 10px;
        border-radius: 6px;
        font-family: "JetBrains Mono", monospace;
        font-size: 13px;
        animation: pop 0.3s ease;
      }
      @keyframes pop {
        from {
          transform: scale(0.5);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
      .results-label {
        font-size: 12px;
        color: var(--muted);
        font-family: "JetBrains Mono", monospace;
      }

      /* nav */
      .viz-nav {
        display: flex;
        gap: 8px;
      }

      /* â”€â”€ COMPLEXITY â”€â”€ */
      .cplx-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-top: 4px;
      }
      .cplx-card {
        background: var(--code-bg);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 20px;
        text-align: center;
      }
      .cplx-card .value {
        font-family: "JetBrains Mono", monospace;
        font-size: 28px;
        font-weight: 700;
        color: var(--accent);
        margin-bottom: 4px;
      }
      .cplx-card .label {
        font-size: 13px;
        color: var(--muted);
      }

      /* â”€â”€ PITFALLS â”€â”€ */
      .pitfall {
        display: flex;
        gap: 14px;
        padding: 14px 0;
        border-bottom: 1px solid var(--border);
      }
      .pitfall:last-child {
        border-bottom: none;
        padding-bottom: 0;
      }
      .pitfall .num-circle {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: var(--accent3);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 13px;
        font-weight: 700;
        flex-shrink: 0;
        margin-top: 2px;
      }
      .pitfall h4 {
        font-size: 14px;
        color: #fff;
        margin-bottom: 4px;
      }
      .pitfall p {
        font-size: 13px;
        color: var(--muted);
        margin: 0;
      }

      code {
        font-family: "JetBrains Mono", monospace;
        background: var(--code-bg);
        border: 1px solid var(--border);
        padding: 1px 6px;
        border-radius: 4px;
        font-size: 12px;
        color: var(--accent);
      }

      @media (max-width: 600px) {
        section {
          padding: 20px 18px;
        }
        .freq-section {
          grid-template-columns: 1fr;
        }
        .cplx-grid {
          grid-template-columns: 1fr 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <!-- HEADER -->
      <div class="header">
        <div class="tag">DSA Revision Notes</div>
        <h1>Find All Anagram Positions</h1>
        <div class="meta">
          <span class="badge yellow">LeetCode #438</span>
          <span class="badge green">Sliding Window</span>
          <span class="badge">Fixed-size Window</span>
          <span class="badge">Frequency Array</span>
        </div>
      </div>

      <!-- PROBLEM -->
      <section>
        <div class="sec-label">01 / Problem</div>
        <h2>What are we solving?</h2>
        <p>
          Given strings <code>s</code> and <code>p</code>, find all start
          indices in <code>s</code> where a substring is an anagram of
          <code>p</code>. An anagram uses the same characters with the same
          frequencies, just in any order.
        </p>
        <p>
          Return an array of all starting indices (0-indexed). The answer can be
          in any order.
        </p>
      </section>

      <!-- INTUITION -->
      <section>
        <div class="sec-label">02 / Intuition</div>
        <h2>Core Idea</h2>
        <div class="cards">
          <div class="card">
            <div class="icon">ðŸªŸ</div>
            <h3>Fixed-Size Window</h3>
            <p>
              We slide a window of length <code>p.length</code> across
              <code>s</code>, one character at a time.
            </p>
          </div>
          <div class="card">
            <div class="icon">ðŸ“Š</div>
            <h3>Frequency Fingerprint</h3>
            <p>
              Instead of sorting, we compare 26-element frequency arrays â€” one
              for <code>p</code>, one for the current window.
            </p>
          </div>
          <div class="card">
            <div class="icon">ðŸ”„</div>
            <h3>Add & Remove</h3>
            <p>
              When the window slides, add the new char entering from the right,
              remove the old char leaving from the left.
            </p>
          </div>
          <div class="card">
            <div class="icon">âœ…</div>
            <h3>Match = Anagram</h3>
            <p>
              If both frequency arrays are identical, the current window is an
              anagram. Record the start index.
            </p>
          </div>
        </div>
      </section>

      <!-- ANNOTATED CODE -->
      <section>
        <div class="sec-label">03 / Code Walkthrough</div>
        <h2>Annotated Solution</h2>
        <div class="code-block">
          <span class="line"
            ><span class="kw">var</span> <span class="fn">findAnagrams</span> =
            <span class="kw">function</span>(s, p) {</span
          >
          <span class="line">
            <span class="kw">let</span> res = [];
            <span class="cmt">// result: start indices</span></span
          >
          <span class="line">
            <span class="kw">let</span> pArr = <span class="kw">new</span>
            <span class="fn">Array</span>(<span class="num">26</span>).<span
              class="fn"
              >fill</span
            >(<span class="num">0</span>);
            <span class="cmt">// freq for p</span></span
          >
          <span class="line">
            <span class="kw">let</span> sArr = <span class="kw">new</span>
            <span class="fn">Array</span>(<span class="num">26</span>).<span
              class="fn"
              >fill</span
            >(<span class="num">0</span>);
            <span class="cmt">// freq for current window</span></span
          >
          <span class="line">
            <span class="kw">let</span> a = <span class="str">"a"</span>.<span
              class="fn"
              >charCodeAt</span
            >(); <span class="cmt">// base char code = 97</span></span
          >
          <span class="line"></span>
          <span class="line">
            <span class="cmt">// Step 1: Build frequency map for p</span></span
          >
          <span class="line">
            <span class="kw">for</span> (<span class="kw">let</span> i =
            <span class="num">0</span>; i &lt; p.length; i++) {</span
          >
          <span class="line">
            pArr[p[i].<span class="fn">charCodeAt</span>() - a]++;
            <span class="cmt">// e.g. 'a' â†’ index 0</span></span
          >
          <span class="line"> }</span>
          <span class="line">
            pArr = pArr.<span class="fn">toString</span>();
            <span class="cmt"
              >// snapshot as string for O(1) compare</span
            ></span
          >
          <span class="line"></span>
          <span class="line">
            <span class="cmt">// Step 2: Slide window over s</span></span
          >
          <span class="line">
            <span class="kw">for</span> (<span class="kw">let</span> i =
            <span class="num">0</span>; i &lt; s.length; i++) {</span
          >
          <span class="line">
            <span class="hi"
              >sArr[s[i].<span class="fn">charCodeAt</span>() - a]++;</span
            >
            <span class="cmt">// ADD: new char enters window</span></span
          >
          <span class="line"></span>
          <span class="line">
            <span class="kw">if</span> (i &gt;= p.length -
            <span class="num">1</span>) {
            <span class="cmt">// window is full (size = p.length)</span></span
          >
          <span class="line">
            <span class="kw">if</span> (sArr.<span class="fn">toString</span>()
            === pArr) <span class="cmt">// COMPARE fingerprints</span></span
          >
          <span class="line">
            res.<span class="fn">push</span>(i + <span class="num">1</span> -
            p.length);
            <span class="cmt">// push start index of this window</span></span
          >
          <span class="line">
            <span class="hi"
              >sArr[s[i + <span class="num">1</span> - p.length].<span
                class="fn"
                >charCodeAt</span
              >() - a]--;</span
            >
            <span class="cmt">// REMOVE: leftmost char leaves</span></span
          >
          <span class="line"> }</span>
          <span class="line"> }</span>
          <span class="line"> <span class="kw">return</span> res;</span>
          <span class="line">};</span>
        </div>
      </section>

      <!-- INTERACTIVE VISUALIZATION -->
      <section>
        <div class="sec-label">04 / Visualization</div>
        <h2>Step-by-Step Simulator</h2>
        <div class="viz-container">
          <div class="viz-controls">
            <span class="viz-label">s =</span>
            <input
              class="viz-input"
              id="sInput"
              value="cbaebabacd"
              maxlength="20"
            />
            <span class="viz-label">p =</span>
            <input
              class="viz-input"
              id="pInput"
              value="abc"
              maxlength="10"
              style="width: 100px"
            />
            <button class="btn btn-primary" onclick="initViz()">Run</button>
          </div>

          <!-- String display -->
          <div style="margin-bottom: 28px">
            <div class="freq-title" style="margin-bottom: 8px">
              String s â€” sliding window
            </div>
            <div class="str-display" id="strDisplay"></div>
          </div>

          <!-- Freq bars -->
          <div class="freq-section">
            <div>
              <div class="freq-title">pArr â€” target frequency (fixed)</div>
              <div class="freq-bars" id="pBars"></div>
              <div
                style="display: flex; gap: 2px; margin-top: 4px"
                id="pLabels"
              ></div>
            </div>
            <div>
              <div class="freq-title">sArr â€” current window frequency</div>
              <div class="freq-bars" id="sBars"></div>
              <div
                style="display: flex; gap: 2px; margin-top: 4px"
                id="sLabels"
              ></div>
            </div>
          </div>

          <!-- Step info -->
          <div class="step-info" id="stepInfo">
            Press Run to start the simulation.
          </div>

          <!-- Results -->
          <div class="results-row">
            <span class="results-label">Result indices:</span>
            <div
              id="resultsDisplay"
              style="display: flex; gap: 6px; flex-wrap: wrap"
            ></div>
          </div>

          <!-- Nav -->
          <div class="viz-controls" style="margin-top: 16px; margin-bottom: 0">
            <div class="viz-nav">
              <button class="btn btn-secondary" onclick="prevStep()">
                â—€ Prev
              </button>
              <button class="btn btn-secondary" onclick="nextStep()">
                Next â–¶
              </button>
              <button class="btn btn-secondary" onclick="autoPlay()">
                â–¶â–¶ Auto
              </button>
            </div>
            <span
              id="stepCounter"
              style="
                font-family: &quot;JetBrains Mono&quot;, monospace;
                font-size: 12px;
                color: var(--muted);
              "
            ></span>
          </div>
        </div>
      </section>

      <!-- COMPLEXITY -->
      <section>
        <div class="sec-label">05 / Complexity</div>
        <h2>Time & Space</h2>
        <div class="cplx-grid">
          <div class="cplx-card">
            <div class="value">O(n)</div>
            <div class="label">
              Time â€” single pass over s<br />Each char is added & removed once
            </div>
          </div>
          <div class="cplx-card">
            <div class="value">O(1)</div>
            <div class="label">
              Space â€” fixed 26-element arrays<br />Independent of input size
            </div>
          </div>
        </div>
      </section>

      <!-- PITFALLS -->
      <section>
        <div class="sec-label">06 / Watch Out For</div>
        <h2>Common Pitfalls</h2>
        <div class="pitfall">
          <div class="num-circle">1</div>
          <div>
            <h4>Off-by-one on window start</h4>
            <p>
              Start index = <code>i + 1 - p.length</code>, not
              <code>i - p.length</code>. When the window is full,
              <code>i</code> is at the last index of the window, so the start is
              <code>i + 1 - p.length</code>.
            </p>
          </div>
        </div>
        <div class="pitfall">
          <div class="num-circle">2</div>
          <div>
            <h4>Compare before remove</h4>
            <p>
              You must check for an anagram match first, then remove the
              leftmost character. The code does this correctly â€” compare, then
              decrement.
            </p>
          </div>
        </div>
        <div class="pitfall">
          <div class="num-circle">3</div>
          <div>
            <h4>The .toString() trick</h4>
            <p>
              Comparing arrays with <code>===</code> in JS compares by reference
              (always false). Converting to string with
              <code>.toString()</code> lets you do value comparison.
              Alternatively, use a counter or compare element-by-element.
            </p>
          </div>
        </div>
        <div class="pitfall">
          <div class="num-circle">4</div>
          <div>
            <h4>Only works for lowercase aâ€“z</h4>
            <p>
              This solution assumes all characters are lowercase English
              letters. For Unicode or mixed-case, use a <code>Map</code> instead
              of a 26-element array.
            </p>
          </div>
        </div>
      </section>
    </div>

    <script>
      // â”€â”€â”€ Visualization Logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      let steps = [];
      let currentStep = 0;
      let autoTimer = null;

      function buildSteps(s, p) {
        const steps = [];
        const a = "a".charCodeAt(0);
        const pArr = new Array(26).fill(0);
        for (let c of p) pArr[c.charCodeAt(0) - a]++;
        const pStr = pArr.toString();

        const sArr = new Array(26).fill(0);
        const results = [];

        // Before loop starts
        steps.push({
          i: -1,
          sArr: [...sArr],
          pArr,
          pStr,
          results: [],
          entering: -1,
          leaving: -1,
          windowStart: -1,
          windowEnd: -1,
          msg: `Built pArr from p="${p}". Now slide window of size ${p.length} over s.`,
          isMatch: false,
        });

        for (let i = 0; i < s.length; i++) {
          const entering = i;
          sArr[s[i].charCodeAt(0) - a]++;

          let isMatch = false;
          let leaving = -1;
          let wStart = Math.max(0, i - p.length + 1);
          let msg = "";

          if (i >= p.length - 1) {
            isMatch = sArr.toString() === pStr;
            const startIdx = i + 1 - p.length;
            if (isMatch) results.push(startIdx);
            leaving = i + 1 - p.length;

            msg = `i=${i}: Add '${s[i]}' â†’ `;
            msg += isMatch
              ? `âœ… ANAGRAM FOUND at index ${startIdx}! Window="${s.slice(startIdx, i + 1)}"`
              : `âŒ No match. Window="${s.slice(startIdx, i + 1)}"`;
            msg += `. Remove '${s[leaving]}' (leftmost).`;

            steps.push({
              i,
              sArr: [...sArr],
              pArr: [...pArr],
              pStr,
              results: [...results],
              entering,
              leaving,
              windowStart: wStart,
              windowEnd: i,
              msg,
              isMatch,
            });

            sArr[s[leaving].charCodeAt(0) - a]--;
          } else {
            msg = `i=${i}: Add '${s[i]}'. Window not full yet (need ${p.length} chars).`;
            steps.push({
              i,
              sArr: [...sArr],
              pArr: [...pArr],
              pStr,
              results: [...results],
              entering,
              leaving: -1,
              windowStart: 0,
              windowEnd: i,
              msg,
              isMatch: false,
            });
          }
        }

        steps.push({
          i: s.length,
          sArr: [...sArr],
          pArr: [...pArr],
          pStr,
          results: [...results],
          entering: -1,
          leaving: -1,
          windowStart: -1,
          windowEnd: -1,
          msg: `Done! Found ${results.length} anagram(s) at index${results.length !== 1 ? "es" : ""}: [${results.join(", ")}]`,
          isMatch: false,
        });

        return steps;
      }

      function initViz() {
        clearInterval(autoTimer);
        const s = document
          .getElementById("sInput")
          .value.replace(/[^a-z]/gi, "")
          .toLowerCase();
        const p = document
          .getElementById("pInput")
          .value.replace(/[^a-z]/gi, "")
          .toLowerCase();
        if (!s || !p || p.length > s.length) {
          document.getElementById("stepInfo").innerHTML =
            '<span style="color:var(--accent3)">Please enter valid strings (s.length â‰¥ p.length, lowercase a-z)</span>';
          return;
        }
        document.getElementById("sInput").value = s;
        document.getElementById("pInput").value = p;
        steps = buildSteps(s, p);
        currentStep = 0;
        renderFreqBars(p);
        renderStep();
      }

      function renderFreqBars(p) {
        // Build label arrays for all 26 chars that matter
        const a = "a".charCodeAt(0);
        const chars = [...p].map((c) => c);
        const unique = [...new Set(chars)].sort();

        // We'll show only letters present in p or s
        const s = document.getElementById("sInput").value;
        const relevant = [
          ...new Set([...p, ...s].filter((c) => /[a-z]/.test(c))),
        ].sort();

        ["pBars", "sBars", "pLabels", "sLabels"].forEach((id) => {
          document.getElementById(id).innerHTML = "";
        });

        relevant.forEach((ch) => {
          ["p", "s"].forEach((which) => {
            const wrap = document.createElement("div");
            wrap.className = "freq-bar-wrap";
            wrap.style.minWidth = "0";

            const bar = document.createElement("div");
            bar.className = "freq-bar";
            bar.id = `${which}Bar_${ch}`;
            bar.style.height = "2px";
            bar.style.width = "100%";
            bar.style.transition = "height 0.3s, background 0.3s";
            wrap.appendChild(bar);
            document.getElementById(`${which}Bars`).appendChild(wrap);

            const lbl = document.createElement("div");
            lbl.className = "freq-bar-label";
            lbl.style.flex = "1";
            lbl.style.textAlign = "center";
            lbl.textContent = ch;
            document.getElementById(`${which}Labels`).appendChild(lbl);
          });
        });

        window._vizChars = relevant;
      }

      function renderStep() {
        if (!steps.length) return;
        const step = steps[currentStep];
        const s = document.getElementById("sInput").value;
        const p = document.getElementById("pInput").value;
        const a = "a".charCodeAt(0);

        // String display
        const disp = document.getElementById("strDisplay");
        disp.innerHTML = "";
        for (let j = 0; j < s.length; j++) {
          const box = document.createElement("div");
          box.className = "char-box";
          box.textContent = s[j];
          const idxEl = document.createElement("span");
          idxEl.className = "idx";
          idxEl.textContent = j;
          box.appendChild(idxEl);

          if (j === step.entering) box.classList.add("entering");
          else if (j === step.leaving) box.classList.add("leaving");
          else if (
            j >= step.windowStart &&
            j <= step.windowEnd &&
            step.i >= 0
          ) {
            box.classList.add(step.isMatch ? "match" : "in-window");
          }
          disp.appendChild(box);
        }

        // Freq bars
        const chars = window._vizChars || [];
        const maxVal = Math.max(p.length, 1);
        chars.forEach((ch) => {
          const idx = ch.charCodeAt(0) - a;
          const pVal = step.pArr[idx] || 0;
          const sVal = step.sArr[idx] || 0;

          const pBar = document.getElementById(`pBar_${ch}`);
          const sBar = document.getElementById(`sBar_${ch}`);
          if (pBar) {
            pBar.style.height = `${Math.min(pVal / maxVal, 1) * 54 + 2}px`;
            pBar.classList.toggle("active", pVal > 0);
          }
          if (sBar) {
            sBar.style.height = `${Math.min(sVal / maxVal, 1) * 54 + 2}px`;
            sBar.classList.toggle("active", sVal > 0);
            sBar.style.background =
              sVal > 0
                ? step.isMatch
                  ? "var(--accent2)"
                  : "var(--accent)"
                : "var(--border)";
          }
        });

        // Step info
        const info = document.getElementById("stepInfo");
        const className = step.isMatch
          ? "match-found"
          : step.i === -1 || step.i >= s.length
            ? ""
            : "no-match";
        info.innerHTML = `<span class="step-num">Step ${currentStep}/${steps.length - 1}</span>  â€”  <span class="${className}">${step.msg}</span>`;

        // Results
        const rd = document.getElementById("resultsDisplay");
        rd.innerHTML = "";
        step.results.forEach((idx) => {
          const badge = document.createElement("div");
          badge.className = "result-badge";
          badge.textContent = idx;
          rd.appendChild(badge);
        });

        // Counter
        document.getElementById("stepCounter").textContent =
          `${currentStep + 1} / ${steps.length}`;
      }

      function nextStep() {
        if (currentStep < steps.length - 1) {
          currentStep++;
          renderStep();
        }
      }
      function prevStep() {
        if (currentStep > 0) {
          currentStep--;
          renderStep();
        }
      }
      function autoPlay() {
        clearInterval(autoTimer);
        autoTimer = setInterval(() => {
          if (currentStep < steps.length - 1) {
            currentStep++;
            renderStep();
          } else clearInterval(autoTimer);
        }, 700);
      }

      // Init on load
      window.onload = initViz;
    </script>
  </body>
</html>
